# QCN拥塞控制算法

## 概述

QCN（Quantized Congestion Notification，量化拥塞通知）是一套应用于L2的端到端拥塞通知机制，通过交换机主动反向发送包含拥塞程度的通知报文，降低发送端的发送速率，又通过主动增速机制来尽可能地利用可用带宽，从而提高网络性能。QCN于2007年提出，其协议规范是IEEE标准(802.1Qau)，主要应用于数据中心场景。

## QCN中的基本概念

RP（Reaction Point）：数据流的发送端，指代网卡，支持QCN协议。
CP（Congestion Point）：使能QCN功能的网络交换设备，可以进行拥塞信息检测。
CNM（Congestion Notification Message）：网络设备检测发生拥塞后发送给数据流源端的报文，启动包含拥塞程度的信息。


## QCN具体算法

量化拥塞通知QCN主要有两部分算法组成，CP算法和RP算法。

### CP算法（拥塞点算法）

发生拥塞的网络交换设备（交换机）对正在发送缓存中准备发送的数据帧进行取样。如果发现出现拥塞，将会产生一个拥塞通告消息（CNM）给被取样的数据帧的发送端。CNM报文的目的MAC为当前采样报文的源MAC，源MAC为当前采样报文的目的MAC，保证CNM报文能发送回RP端，并将采样报文中的Vlan tag、CN-TAG信息填入CNM报文。

根据IEEE标准，CP是一个具有输出缓存的交换机，该缓存如下图所示。CP算法的目的就是将缓存的占用率维持在期望点Q*eq*

### RP算法（接收点算法）

