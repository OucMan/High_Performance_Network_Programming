# HPCC

## 概述

在高速网络中，拥塞控制是实现超低时延、高带宽以及稳定性的关键技术。本文提出了一种高精度拥塞控制算法HPCC（High Precision Congestion Control）同时实现上述的三个目标。HPCC通过利用带内遥测技术INT来获得精确的链路负载，进而准确地控制流量。通过解决拥塞期间延迟的INT信息和对INT信息过度反应等难题，HPCC可以迅速收敛以利用空闲带宽，同时避免拥塞，并且可以保持接近零的网络内队列以实现超低延迟。 HPCC也是公平且易于在硬件中部署的，本文作者使用可编程NIC和交换机来实现HPCC。在评估中，与DCQCN和TIMELY相比，HPCC将流完成时间缩短了多达95％，即使在大规模incast场景下也不会造成拥堵。

## 当前方案的不足

当前的解决方案，如DCQCN和TIMELY存在以下的不足：

### 慢收敛

当接收到粗粒度的拥塞反馈后，如ECN和RTT，当前的拥塞控制机制不能确切的知道增加或者减少多少发送速率，而是通过启发式算法多次迭代找到稳定的发送速率。

### 不可避免的数据包排队

只有当交换机队列中积累一定数量的数据包时，ECN数据包才会出现，或者RTT大的变化才会发生，但是这时候的队列对明显增加网络时延。

### 复杂的参数调优

当前启发式拥塞控制算法有很多的参数，为了实现最好的效果，需要仔细认真地进行参数调优。

对应的HPCC背后的关键思想是利用来自INT的精确链路负载信息来计算准确的流速更新。 与通常需要大量迭代才能找到合适流速的现有方法不同，HPCC在大多数情况下仅需要一个速率更新步骤。 使用来自INT的精确信息，HPCC可以解决当前CC方案中的三个限制。 首先，HPCC发送方可以快速提高流量以实现高利用率，或者降低流量以避免拥塞。 其次，HPCC发送者可以快速调整流量，以使每个链接的输入速率略低于该链接的容量，从而防止建立队列并保持较高的链接利用率。 最终，由于发送速率是根据交换机上的直接测量值精确计算得出的，因此HPCC仅需要3个独立的参数即可调整公平性和效率。


## HPCC模型

HPCC利用网络内遥测技术(INT)来获取精确的链路负载信息，并精确地控制流量。通过处理INT信息，HPCC可以快速利用空闲带宽，同时避免拥塞，并可以保持接近于零的网络内队列，实现超低延迟。

如下图所示，发送方发送的每个数据包将由接收方确认。在从发送器到接收器的数据包传播过程中，沿路径的每个交换机利用其INT功能来插入一些数据，这些数据报告了包括时间戳（ts），队列长度（qLen），发送字节数（tx字节）和链路带宽容量（B）的信息。当接收方获取数据包时，它会将记录的所有元数据复制到ACK消息中发送回发送方。每次收到带有网络负载信息的ACK时，发送方决定如何调整其流速。

### 基于飞行字节的拥塞控制

HPCC是一个基于窗口的拥塞控制机制，用来控制飞行数据包字节，飞行数据包字节就是已经发出但是还没有接收到确认消息的字节，也就是正在传输过程中的字节。当没有拥塞发生时，飞行字节与发送速率可以互换，infliдht = rate × T，其中T为RTT。但是使用飞行字节能够很好的容忍拥塞发生时反馈延迟达到的问题，也就是说拥塞发生时，可能会导致拥塞信号晚收到，从而导致发送者晚降低速率，但是使用飞行字节，可以使用保证目前在链路上的字节的总量。

每个发送方都维护一个发送窗口，该窗口限制了它可以发送的飞行字节。初始发送窗口的大小设置为Winit = B*NIC* × T，其中B*NIC*是NIC带宽，T为RTT，以便流可以以线速开始。

除了发送窗口外，HPCC的拥塞信号和控制规律也基于飞行字节。飞行字节直接对应于链接利用率。 具体来说，对于链接，飞行字节是所有经过该链接的流的总传输字节。 假设链接的带宽为B，并且经过该链接的第i个流的窗口大小为W*i*。 该链接的飞行字节为 I = &Sigma W*i*。

当飞行包的大小小于带宽乘RTT，也就是带宽延时积（BDP）的时候，说明信息量不能填满这样的“管道”，则链路未被充分利用，即还没有发生拥塞。


同理当当飞行包的大小大于带宽乘RTT的时候，总吞吐量将超过链路带宽，发生拥塞。


所以，论文使用总的飞行包的大小来检测是否发生拥塞，并且目标是控制 I 略小于B × T。链路上飞行包大小由队列和管道中的数据包组成，计算公式为:

total in flight bytes = qlen + txRate × T

其中队列长度可以在INT中直接获取，txRate由txBytes和ts计算得到，如下

txRate = (ack*1*.txBytes - ack*0*.txBytes ) / (ack*1*.ts - ack*0*.ts)

这里设计一个参数 η，它是一个非常接近1的数，一般把它取值为95%，HPCC通过按照一个参数K调整发送窗口将飞行字节大小维持在η * B * T。

K = I / (η * B * T)

W = W / K + W*ai*，W*ai*用来确保公平性，数值很小。


### 快反应（而非过度反应）




























## 论文

HPCC: High Precision Congestion Control



